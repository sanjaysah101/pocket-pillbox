<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pocket Pillbox ‚Äì Offline Med Reminder</title>
    <style>
        html {
            box-sizing: border-box;
            font-size: 18px;
            background: #f8fafc;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            color: #222;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: inherit;
            transition: background 0.3s, color 0.3s;
        }

        header {
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 2.1rem;
            font-weight: bold;
            color: #057fa3;
            text-align: center;
        }

        main {
            width: 100%;
            max-width: 440px;
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.10);
            padding: 1.5rem 1.2rem 2.5rem 1.2rem;
            margin-bottom: 2rem;
        }

        form {
            margin-bottom: 1.5rem;
        }

        fieldset {
            border: 2px solid #cbe0fb;
            border-radius: 0.75em;
            padding: 1em;
            margin: 0;
            background: #eaf7ff;
        }

        legend {
            font-weight: bold;
            color: #036ba2;
            font-size: 1.12em;
            transition: color 0.2s;
        }

        label {
            display: block;
            margin: 0.4em 0 0.7em 0;
            font-size: 1em;
        }

        input[type="text"],
        input[type="time"] {
            font-size: 1em;
            padding: 0.4em 0.6em;
            margin-left: 0.6em;
            border: 2px solid #b7dfff;
            border-radius: 0.4em;
            outline: none;
            width: 74%;
            max-width: 210px;
            transition: border-color 0.2s, background 0.2s;
            background: #f6fcff;
        }

        input:focus {
            border-color: #1076ba;
            background: #e5f4ff;
        }

        button {
            font-size: 1em;
            padding: 0.6em 1em;
            background-color: #057fa3;
            color: #fff;
            border: none;
            border-radius: 0.5em;
            cursor: pointer;
            margin-top: 0.5em;
            margin-bottom: 0.2em;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 6px rgba(5, 127, 163, 0.15);
        }

        button:focus,
        button:hover {
            background: #045e7a;
            outline: none;
        }

        #clear-all {
            background: #d42323;
            margin-top: 1.1em;
            font-size: 0.98em;
        }

        #clear-all:focus,
        #clear-all:hover {
            background: #b11414;
        }

        section#reminders-section {
            margin-top: 1.5em;
        }

        h2 {
            font-size: 1.23em;
            margin-bottom: 0.6em;
            color: #2479bb;
        }

        ul#reminders-list {
            padding: 0;
            list-style: none;
            margin-bottom: 0.6em;
            min-height: 2.2em;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            background: #f3faff;
            border: 1.5px solid #b1dafd;
            border-radius: 0.45em;
            margin-bottom: 0.57em;
            padding: 0.7em 0.8em 0.7em 0.55em;
            font-size: 1.09em;
            transition: background 0.15s;
        }

        .reminder-item.checked {
            background: #dfa;
            opacity: 0.65;
            text-decoration: line-through;
        }

        .reminder-checkbox {
            accent-color: #057fa3;
            width: 1.3em;
            height: 1.3em;
            margin-right: 0.7em;
            cursor: pointer;
        }

        .reminder-info {
            flex: 1;
        }

        .reminder-time {
            color: #158034;
            font-size: 0.96em;
            margin-left: 0.6em;
        }

        .edit-pill-btn,
        .delete-pill-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            color: #036ba2;
            padding: 0.2em 0.4em;
            margin: 0 0.2em;
            font-size: 1em;
            transition: color 0.15s, background 0.15s;
        }

        .edit-pill-btn:hover,
        .delete-pill-btn:hover {
            color: #FF9800;
            background: #e5f4ff;
            border-radius: 0.3em;
        }

        .delete-pill-btn {
            color: #b11414;
        }

        .delete-pill-btn:hover {
            color: #fff;
            background: #d42323;
        }

        #toggle-dark {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.05em;
            background: #222;
            color: #fff;
            border-radius: 0.7em;
            border: none;
            padding: 0.48em 0.75em;
            cursor: pointer;
            transition: background 0.16s, color 0.18s;
        }

        #toggle-dark:hover {
            background: #333;
        }

        @media (max-width: 600px) {
            main {
                padding: 1.1rem 0.5rem 1.8rem 0.5rem;
            }

            html {
                font-size: 16px;
            }

            #toggle-dark {
                right: 0.65rem;
            }
        }

        /* --- Dark Mode --- */
        body.dark {
            background: #20262b;
            color: #eee;
        }

        body.dark main {
            background: #23262c;
            color: #eee;
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.2);
        }

        body.dark fieldset {
            background: #232f35;
            border: 2px solid #495c68;
        }

        body.dark legend,
        body.dark h2 {
            color: #9bdcff;
        }

        body.dark .reminder-item {
            background: #1b2630;
            border: 1.5px solid #3db3da;
        }

        body.dark .reminder-item.checked {
            background: #375647;
            color: #c5c5c5;
        }

        body.dark input,
        body.dark input:focus {
            background: #151b20;
            color: #edf8fc;
            border-color: #406887;
        }

        body.dark button {
            background-color: #155218;
            color: #cdf6fa;
        }

        body.dark button#clear-all {
            background: #750e19;
        }

        body.dark button#toggle-dark {
            background: #555;
            color: #fff;
        }
    </style>
</head>

<body>
    <header>
        <h1>ü©∫ Pocket Pillbox</h1>
    </header>

    <button id="toggle-dark" aria-label="Switch to dark mode" title="Toggle dark mode">üåô</button>
    <main>
        <form id="pill-form" autocomplete="off">
            <fieldset>
                <legend>üíä Add Medication</legend>
                <label>
                    Name:
                    <input type="text" id="pill-name" maxlength="50" required autocomplete="off" aria-label="Pill name">
                </label>
                <label>
                    Dosage:
                    <input type="text" id="pill-dosage" maxlength="20" autocomplete="off" aria-label="Dosage">
                </label>
                <label>
                    Time:
                    <input type="time" id="pill-time" aria-label="Time">
                </label>
                <button id="add-btn" type="submit" style="margin-top:0.7em;">
                    Add Reminder
                </button>
            </fieldset>
        </form>

        <section id="reminders-section" aria-label="Today‚Äôs medications">
            <h2>Today‚Äôs Medications</h2>
            <ul id="reminders-list"></ul>
            <button id="clear-all" type="button" aria-label="Clear all reminders">
                Clear All
            </button>
        </section>
    </main>
    <script>
        // --- Pocket Pillbox Core Logic ---
        const FORM = document.getElementById('pill-form');
        const NAME = document.getElementById('pill-name');
        const DOSAGE = document.getElementById('pill-dosage');
        const TIME = document.getElementById('pill-time');
        const LIST = document.getElementById('reminders-list');
        const CLEAR = document.getElementById('clear-all');
        // For edit button text change and state
        const ADD_BTN = document.getElementById('add-btn');
        const LEGEND = FORM.querySelector('legend');

        // Use a unique key to avoid conflict in localStorage
        const STORAGE_KEY = 'pocket-pillbox-reminders-v1';

        // Reminder format: { id, name, dosage, time, taken }
        let reminders = loadReminders();
        let editId = null; // if not null, we're editing

        renderReminders();

        // --- Form Submission (Add/Update) ---
        FORM.addEventListener('submit', function (e) {
            e.preventDefault();
            const name = NAME.value.trim();
            if (!name) return;
            if (editId !== null) {
                // --- Update existing reminder ---
                const rem = reminders.find(r => r.id === editId);
                if (rem) {
                    rem.name = name;
                    rem.dosage = DOSAGE.value.trim();
                    rem.time = TIME.value;
                    // Keep "taken" state as is
                    saveReminders();
                    renderReminders();
                }
                // Reset editing state
                editId = null;
                LEGEND.textContent = 'üíä Add Medication';
                ADD_BTN.textContent = 'Add Reminder';
            } else {
                // --- Add new reminder ---
                const reminder = {
                    id: Date.now(),
                    name,
                    dosage: DOSAGE.value.trim(),
                    time: TIME.value,
                    taken: false
                };
                reminders.push(reminder);
                saveReminders();
                renderReminders();
            }
            FORM.reset();
            NAME.focus();
        });

        // --- Mark As Taken ---
        LIST.addEventListener('change', function (e) {
            if (e.target.classList.contains('reminder-checkbox')) {
                const id = Number(e.target.dataset.id);
                const found = reminders.find(r => r.id === id);
                if (found) {
                    found.taken = e.target.checked;
                    saveReminders();
                    renderReminders();
                }
            }
        });

        // --- Delete & Edit Buttons ---
        LIST.addEventListener('click', function (e) {
            // --- Delete ---
            if (e.target.classList.contains('delete-pill-btn')) {
                const id = Number(e.target.dataset.id);
                if (confirm('Delete this reminder?')) {
                    reminders = reminders.filter(r => r.id !== id);
                    saveReminders();
                    renderReminders();
                }
                // Reset edit mode if we're deleting the one being edited
                if (editId === id) {
                    editId = null;
                    FORM.reset();
                    LEGEND.textContent = 'üíä Add Medication';
                    ADD_BTN.textContent = 'Add Reminder';
                }
            }
            // --- Edit ---
            else if (e.target.classList.contains('edit-pill-btn')) {
                const id = Number(e.target.dataset.id);
                const toEdit = reminders.find(r => r.id === id);
                if (toEdit) {
                    NAME.value = toEdit.name;
                    DOSAGE.value = toEdit.dosage || '';
                    TIME.value = toEdit.time || '';
                    editId = id;
                    LEGEND.textContent = '‚úèÔ∏è Edit Medication';
                    ADD_BTN.textContent = 'Update Reminder';
                    NAME.focus();
                }
            }
        });

        // --- Clear All Reminders ---
        CLEAR.addEventListener('click', function () {
            if (confirm('Clear all reminders?')) {
                reminders = [];
                saveReminders();
                renderReminders();
            }
            // Also reset edit mode, if active
            editId = null;
            FORM.reset();
            LEGEND.textContent = 'üíä Add Medication';
            ADD_BTN.textContent = 'Add Reminder';
        });

        // --- ESC to cancel editing ---
        FORM.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && editId !== null) {
                editId = null;
                FORM.reset();
                LEGEND.textContent = 'üíä Add Medication';
                ADD_BTN.textContent = 'Add Reminder';
                NAME.focus();
            }
        });

        // --- LocalStorage Helpers ---
        function loadReminders() {
            try {
                return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            } catch { return []; }
        }
        function saveReminders() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(reminders));
        }

        // --- Render Reminders ---
        function renderReminders() {
            LIST.innerHTML = '';
            if (reminders.length === 0) {
                LIST.innerHTML = '<li style="color:#888; font-size:1em;">No reminders set yet.</li>';
                return;
            }
            reminders.forEach(reminder => {
                const li = document.createElement('li');
                li.className = 'reminder-item' + (reminder.taken ? ' checked' : '');
                // Checkbox
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'reminder-checkbox';
                checkbox.dataset.id = reminder.id;
                checkbox.checked = reminder.taken;
                checkbox.setAttribute('aria-label', `Mark ${reminder.name} as taken`);

                // Info
                const info = document.createElement('span');
                info.className = 'reminder-info';
                info.textContent = `${reminder.name}` + (reminder.dosage ? ` (${reminder.dosage})` : '');

                // Time display
                const timeSpan = document.createElement('span');
                timeSpan.className = 'reminder-time';
                timeSpan.textContent = reminder.time ? ` | üïë ${reminder.time}` : '';

                // --- EDIT Button ---
                const editBtn = document.createElement('button');
                editBtn.type = 'button';
                editBtn.className = 'edit-pill-btn';
                editBtn.textContent = '‚úèÔ∏è';
                editBtn.title = 'Edit reminder';
                editBtn.dataset.id = reminder.id;

                // --- DELETE Button ---
                const delBtn = document.createElement('button');
                delBtn.type = 'button';
                delBtn.className = 'delete-pill-btn';
                delBtn.textContent = 'üóëÔ∏è';
                delBtn.title = 'Delete reminder';
                delBtn.dataset.id = reminder.id;

                // Build list item
                li.appendChild(checkbox);
                li.appendChild(info);
                if (reminder.time) li.appendChild(timeSpan);
                li.appendChild(editBtn);
                li.appendChild(delBtn);
                LIST.appendChild(li);
            });
        }

        // --- Service Worker: Full Offline Experience ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Inline service worker for single-file hackathon!
                const SW_CODE = `
          const CACHE_NAME = 'pillbox-offline-v1';
          self.addEventListener('install', event => {
            event.waitUntil(
              caches.open(CACHE_NAME).then(cache => cache.addAll([
                location.pathname
              ]))
            );
            self.skipWaiting();
          });
          self.addEventListener('fetch', event => {
            event.respondWith(
              caches.match(event.request).then(response => (
                response || fetch(event.request)
              ))
            );
          });
        `;
                const blob = new Blob([SW_CODE], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(swUrl);
            });
        }

        // --- Dark mode toggle ---
        const DARK_BTN = document.getElementById('toggle-dark');
        function setDark(state) {
            document.body.classList.toggle('dark', state);
            DARK_BTN.textContent = state ? '‚òÄÔ∏è' : 'üåô';
            DARK_BTN.setAttribute('aria-label', state ? 'Switch to light mode' : 'Switch to dark mode');
            localStorage.setItem('pillbox-dark', state ? '1' : '');
        }
        DARK_BTN.addEventListener('click', () => setDark(!document.body.classList.contains('dark')));
        // Keep mode on reload
        setDark(localStorage.getItem('pillbox-dark') === '1');
    </script>
</body>

</html>